const { fetchOHLC } = require("./lib/fetchData");
const { getIndicatorScore } = require("./lib/indicators");
const fetch = require("node-fetch");

const API_URL = "http://localhost:3000/api/top-signals";

async function runAnalysis() {
  const coins = ["bitcoin", "ethereum", "pepe"];

  for (let coin of coins) {
    const closes = await fetchOHLC(coin, "usd", 1);
    if (closes.length === 0) continue;

    const score = getIndicatorScore(closes);
    let confidence = "NEUTRAL";
    if (score > 70) confidence = "STRONG BUY ðŸš€";
    else if (score < 40) confidence = "STRONG SELL ðŸ”»";

    await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ coin, score, confidence, timestamp: Date.now() }),
    });
  }
}

setInterval(runAnalysis, 5000);
